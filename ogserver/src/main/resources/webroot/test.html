<html>
<head>
    <script type="text/javascript" src="/js/libs/jquery/dist/jquery.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
    <script>
     // Initialize Firebase
     var config = {
       apiKey: "AIzaSyALgwN8p4bsgNDskEP_F4IPEyJTeUaQqTo",
       authDomain: "mygubbi-cep.firebaseapp.com",
       databaseURL: "https://mygubbi-cep.firebaseio.com",
       storageBucket: "mygubbi-cep.appspot.com",
       messagingSenderId: "623623245186"
     };
     firebase.initializeApp(config);
    </script>
</head>
<body>
    <h1 id="test"></h1>
    <!--<script>
        var test = document.getElementById('test');
        var dbref = firebase.database().ref('products').child('Mynest');
        var dbref1 = dbref.child('product_details');
        var dbref2 = dbref1.child('property_name');
        dbref2.on('value',snap => test.innerText = snap.val());
    </script>-->
<!--
    <div class="modal-content signup">
        <h2>
            Create a new Account
        </h2>
        <form id="registerForm" data-toggle="validator" role="form">
            <div class="row">
                <div class="margin-bottom20 form-group">
                    <p class="margin0">Full Name*</p>
                    <input type="text" class="width100 form-control" placeholder="John Doe" id="reg_full_name" required/>
                    <span class="glyphicon form-control-feedback" aria-hidden="true"></span>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="margin-bottom20 form-group has-feedback">
                    <p class="margin0">Contact Number</p>
                    <input type="number" class="width100 form-control" placeholder="9876543210 or 8076543210" id="reg_contact_num" pattern="\d{10}"/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="margin-bottom20 form-group">
                    <p class="margin0">Email ID*</p>
                    <input type="email" class="width100 form-control" placeholder="abc@xyz.com" id="reg_email_id" required pattern=".+@.+\..+" title="<abc>@<xyz>.<com>"/>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="form-group">
                    <div class="margin-bottom20 form-group">
                        <p class="margin0">Password*</p>
                        <input type="password" data-minlength="6" class="width100 form-control" id="reg_password" pattern=".{6,}"
                               required/>
                        <span class="help-block">Minimum of 6 characters</span>
                    </div>
                    <div class="margin-bottom20 form-group">
                        <p class="margin0">Confirm Password*</p>
                        <input type="password" id="reg_confirm" class="width100 form-control"
                               data-match="#reg_password" data-match-error="Whoops, these don't match" required/>
                        <div id="reg_confirm_error" class="help-block with-errors"></div>
                    </div>
                </div>
                <div class="align-center form-group">
                    <button
                            class="button-blue margin-top20 margin-bottom20"
                            type="submit"
                            data-loading-text="<i class='fa fa-spinner fa-spin'></i> sign up">
                        sign up
                    </button>
                </div>
            </div>
        </form>
    </div>
-->
    <script>
        $(document).ready(function() {
            var path = $(location).attr('href');

            var vars = [], hash;
            var q = document.URL.split('?')[1];
            if(q != undefined){
                q = q.split('&');
                for(var i = 0; i < q.length; i++){
                    hash = q[i].split('=');
                    vars.push(hash[1]);
                    vars[hash[0]] = hash[1];
                }
            }
            alert(vars['name']);
            alert(vars['email']);
            alert(vars['phone']);
            alert(vars['password']);

            var name = vars['name'];
            var email = vars['email'];
            var phone = vars['phone'];
            var password = vars['password'];
            var photoURL = vars['photoURL'] ? vars['photoURL']: 'https://res.cloudinary.com/mygubbi/image/upload/f_auto/user.png';

            console.log(photoURL);

            firebase.auth().createUserWithEmailAndPassword(email, password).then(function(userData) {
                console.log("Successfully created user account with uid:", userData.uid);

                var userData = {
                    providerData: "password",
                    email: email,
                    displayName: name,
                    profileImage: photoURL,
                    uid: userData.uid
                };
                    createUser(userData);
                 var profileData = {
                    displayName: name,
                    email: email,
                    phone: phone,
                    profileImage: photoURL,
                };
                createProfile(userData,profileData);
            }, function(error) {
                // An error happened.
                console.log("Error creating user:", error);
            });

        });
        function createUser(userData){
            alert(' -------I am------ ');
            firebase.database().ref().child("users").child(userData.uid).set(userData, function(error) {
                if (error) {
                    console.log("Data could not be saved." + error);
                } else {
                    console.log("Data saved successfully.");
                }
            });
        }
        function createProfile(userData,profileData){
            alert(' -------here------ ');

            firebase.database().ref().child('user-profiles').child(userData.uid).set(
                profileData,
                function(error) {
                    if (error) {
                        console.log("password profile data could not be saved." + error);
                    } else {
                        console.log("data saved successfully.");
                    }
                }
            );
        }
    </script>
</body>
</html>